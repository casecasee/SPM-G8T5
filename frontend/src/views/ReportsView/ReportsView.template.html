<div class="tasks-page">
  <div class="tasks-header">
    <h2>Tasks</h2>
    <div class="header-buttons">


    </div>
  </div>

  <!-- Tabs visible to all users -->
  <div class="tabs">
    <button :class="['tab', currentTab==='individual_report' ? 'active' : '']"
      @click="currentTab='individual_report'">My Task Report</button>
    <button :class="['tab', currentTab==='dept_report' ? 'active' : '']" @click="currentTab='dept_report'">Department
      Report</button>
    <button :class="['tab', currentTab==='company_report' ? 'active' : '']" @click="currentTab='company_report'"
      v-if="isSeniorManagerOrHR">Company Report</button>

  </div>

  <!--individual report-->
  <div v-if="currentTab==='individual_report'" class="report-tab">
    <div class="report-controls">
      <div class="left-controls">
        <label for="start-date">Start:</label>
        <input type="date" v-model="startDate" id="start-date" @change="filterTasksByDate" />
        <label for="end-date">End:</label>
        <input type="date" v-model="endDate" id="end-date" @change="filterTasksByDate" />
        <button class="filter-btn" @click="filterTasksByDate">Filter by Date</button>
      </div>
      <div class="right-controls">
        <button class="download-btn" @click="printReport">Download Report</button>
      </div>
    </div>

    <div class="report-card">
      <h2 class="report-title">üìä Task Report</h2>
      <div class="report-summary">
        <h3>Task Summary ({{formattedDateRange}})</h3>
        <ul>
          <li><strong>Overall Progress:</strong> {{ report_overallProgress }}</li>
          <li><strong>Total Tasks:</strong> {{ report_displayTasks.length }}</li>
          <li><strong>Overdue Tasks:</strong> {{ report_overdueTasks.length }}</li>
          <li><strong>High Priority:</strong> {{ report_tasksByPriority.high.length }}</li>
          <li><strong>Medium Priority:</strong> {{ report_tasksByPriority.medium.length }}</li>
          <li><strong>Low Priority:</strong> {{ report_tasksByPriority.low.length }}</li>
          <li>
            <strong>Completed Tasks:</strong>
            {{
            report_displayTasks.filter(
            t => t.status?.toLowerCase() === 'done' || t.status?.toLowerCase() === 'completed'
            ).length
            }}
          </li>
        </ul>


      </div>

      <!-- High Priority -->
      <div class="task-section">
        <div class="section-header report-high-priority-header">
          <span>High Priority</span>
          <span class="task-count">{{ report_tasksByPriority.high.length }}</span>
        </div>

        <div class="task-details">
          <div v-if="hasTasksInSection('high')" class="priority-section">
            <div class="tasks-grid">
              <Card v-for="task in report_tasksByPriority.high" :key="task.id" class="task-card"
                :class="{'task-overdue': isOverdue(task)}" @click="openDetails(task) ">
                <template #title>
                  <p v-if="isOverdue(task)" class="report-overdue-label">‚ö†Ô∏è Overdue</p>
                  <div class="task-title-row">
                    <span>{{ task.name }}</span>
                  </div>
                  <p class="desc" style="font-weight: normal;">{{ task.description }}</p>
                </template>

                <template #content>
                  <div class="task-body">
                    <div class="task-info">
                      <div class="info-item">
                        <i class="pi pi-calendar-plus"></i>
                        <strong>Start:</strong> {{ formatDate(task.created_at) }}
                      </div>

                      <div class="info-item">
                        <i class="pi pi-calendar-times"></i>
                        <strong>Due:</strong> {{ formatDate(task.due_date) }}
                        <span class="relative-time">({{ formatDateRelative(task.due_date) }})</span>
                      </div>

                      <div class="info-item">
                        <i class="pi pi-bolt"></i>
                        <strong>Priority Score:</strong>
                        <span class="priority-tag">
                          {{ task.priority || 'N/A' }}
                        </span>
                      </div>

                      <div class="info-item">
                        <i class="pi pi-check-circle"></i>
                        <strong>Status:</strong>
                        <span class="status-pill" :class="getStatusClass(task.status)">
                          {{ task.status }}
                        </span>
                      </div>

                      <div class="info-item">
                        <i class="pi pi-user"></i>
                        <strong>Owner:</strong> {{ getOwnerName(task.owner) || currentEmployeeName }}
                      </div>

                      <div class="info-item">
                        <i class="pi pi-users"></i>
                        <strong>Collaborators:</strong> {{ getCollaboratorNames(task.collaborators) || 'None' }}
                      </div>
                    </div>
                  </div>
                </template>

              </Card>
            </div>
          </div>
          <p v-else class="no-tasks-message">No high priority tasks in this timeframe</p>
        </div>
      </div>

      <!--Medium Priority-->
      <div class="task-section">
        <div class="section-header report-medium-priority-header">
          <span>Medium Priority</span>
          <span class="task-count">{{ report_tasksByPriority.medium.length }}</span>
        </div>
        <div class="task-details">
          <!-- <div class="section-header ongoing">Ongoing</div> -->
          <div v-if="hasTasksInSection('medium')" class="priority-section">

            <div class="tasks-grid">
              <Card v-for="task in report_tasksByPriority.medium" :key="task.id" class="task-card"
                :class="{'task-overdue': isOverdue(task)}" @click="openDetails(task)">

                <template #title>
                  <p v-if="isOverdue(task)" class="report-overdue-label">‚ö†Ô∏è Overdue</p>
                  <div class="task-title-row">
                    <span>{{ task.name }}</span>

                  </div>
                  <p class="desc" style="font-weight: normal;">{{ task.description }}</p>
                </template>

                <template #content>
                  <div class="task-body">
                    <div class="task-info">
                      <div class="info-item">
                        <i class="pi pi-calendar-plus"></i>
                        <strong>Start:</strong> {{ formatDate(task.created_at) }}
                      </div>

                      <div class="info-item">
                        <i class="pi pi-calendar-times"></i>
                        <strong>Due:</strong> {{ formatDate(task.due_date) }}
                        <span class="relative-time">({{ formatDateRelative(task.due_date) }})</span>
                      </div>

                      <div class="info-item">
                        <i class="pi pi-bolt"></i>
                        <strong>Priority Score:</strong>
                        <span class="priority-tag">
                          {{ task.priority || 'N/A' }}
                        </span>
                      </div>

                      <div class="info-item">
                        <i class="pi pi-check-circle"></i>
                        <strong>Status:</strong>
                        <span class="status-pill" :class="getStatusClass(task.status)">
                          {{ task.status }}
                        </span>
                      </div>

                      <div class="info-item">
                        <i class="pi pi-user"></i>
                        <strong>Owner:</strong> {{ getOwnerName(task.owner) || currentEmployeeName }}
                      </div>

                      <div class="info-item">
                        <i class="pi pi-users"></i>
                        <strong>Collaborators:</strong> {{ getCollaboratorNames(task.collaborators) || 'None' }}
                      </div>
                    </div>
                  </div>
                </template>
              </Card>
            </div>
          </div>
          <p v-else class="no-tasks-message">No medium priority tasks in this timeframe</p>
        </div>
      </div>

      <!-- Low Priority -->
      <div class="task-section">
        <div class="section-header report-low-priority-header">
          <span>Low Priority</span>
          <span class="task-count">{{ report_tasksByPriority.low.length }}</span>
        </div>
        <div class="task-details">

          <div v-if="hasTasksInSection('low')" class="priority-section">
            <div class="tasks-grid">
              <Card v-for="task in report_tasksByPriority.low" :key="task.id" class="task-card"
                :class="{ 'task-overdue': isOverdue(task) }" @click="openDetails(task)">
                <template #title>
                  <p v-if="isOverdue(task)" class="report-overdue-label">‚ö†Ô∏è Overdue</p>
                  <div class="task-title-row">
                    <span>{{ task.name }}</span>
                  </div>
                  <p class="desc" style="font-weight: normal;">{{ task.description }}</p>
                </template>

                <template #content>
                  <div class="task-body">
                    <div class="task-info">
                      <div class="info-item">
                        <i class="pi pi-calendar-plus"></i>
                        <strong>Start:</strong> {{ formatDate(task.created_at) }}
                      </div>

                      <div class="info-item">
                        <i class="pi pi-calendar-times"></i>
                        <strong>Due:</strong> {{ formatDate(task.due_date) }}
                        <span class="relative-time">({{ formatDateRelative(task.due_date) }})</span>
                      </div>

                      <div class="info-item">
                        <i class="pi pi-bolt"></i>
                        <strong>Priority Score:</strong>
                        <span class="priority-tag">
                          {{ task.priority || 'N/A' }}
                        </span>
                      </div>

                      <div class="info-item">
                        <i class="pi pi-check-circle"></i>
                        <strong>Status:</strong>
                        <span class="status-pill" :class="getStatusClass(task.status)">
                          {{ task.status }}
                        </span>
                      </div>

                      <div class="info-item">
                        <i class="pi pi-user"></i>
                        <strong>Owner:</strong> {{ getOwnerName(task.owner) || currentEmployeeName }}
                      </div>

                      <div class="info-item">
                        <i class="pi pi-users"></i>
                        <strong>Collaborators:</strong> {{ getCollaboratorNames(task.collaborators) || 'None' }}
                      </div>
                    </div>
                  </div>
                </template>
              </Card>
            </div>
          </div>
          <p v-else class="no-tasks-message">No low priority tasks in this timeframe</p>
        </div>
      </div>
    </div>
  </div>


 <!-- Department Report -->
<!-- ========================= -->

<!-- ================== Department Report ================== -->
<div v-if="currentTab==='dept_report'" class="report-tab">
   <div class="report-controls">
     <div class="left-controls">
      <button class="filter-btn" @click="toggleDeptFilterMenu">Filter By</button>

      <div v-if="showDeptFilterMenu" class="filter-menu" @click.stop>
         Filter by Employee 
        <div class="filter-section">
          <label>
            <input type="checkbox" v-model="deptFilterByEmployee" /> Filter by Employee
          </label>

          <div v-if="deptFilterByEmployee" class="employee-checkbox-list">
            <label v-for="emp in departmentEmployees" :key="emp.employee_id">
              <input
                type="checkbox"
                :value="emp.employee_id"
                v-model="deptSelectedEmployeeIds"
              />
              {{ emp.employee_name }}
            </label>
          </div>
        </div>

     

        <div class="filter-section">
          <label>
            <input type="checkbox" v-model="deptFilterByTask" /> Filter by Task
          </label>
        </div>

      
        <div class="filter-section">
          <label for="start-date-dept">Start:</label>
          <input type="date" v-model="deptStartDate" id="start-date-dept" />
          <label for="end-date-dept">End:</label>
          <input type="date" v-model="deptEndDate" id="end-date-dept" />
        </div>

        
        <div class="filter-buttons">
          <button class="save-task-btn" @click="applyDeptFilters">Done</button>
          <button class="cancel-subtask-btn" @click="toggleDeptFilterMenu">
            Cancel
          </button>
        </div>
      </div>
    </div> 

    <div class="right-controls">
      <button class="download-btn" @click="printReport">Download Report</button>
    </div>
  </div> 

<div class="report-card">
  <!-- === CASE 1: FILTER BY EMPLOYEE(S) === -->
  <template v-if="deptFilterByEmployee && dept_employeeReports.length">
    <div
      v-for="empReport in dept_employeeReports"
      :key="empReport.employee.employee_id"
      class="employee-report"
    >
      <h2 class="report-title">
        üë§ {{ empReport.employee.employee_name }}'s Task Report
      </h2>

      <div class="report-summary">
        <h3>Summary ({{ formattedDeptDateRange }})</h3>
        <ul>
          <li><strong>Department:</strong> {{ dept_overallProgress }}</li>
          <li><strong>Total Tasks:</strong> {{ empReport.tasks.length }}</li>
          <li>
            <strong>Overdue Tasks:</strong>
            {{ empReport.tasks.filter(t => isOverdue(t)).length }}
          </li>
          <li>
            <strong>High Priority:</strong>
            {{ groupTasksByPriority(empReport.tasks).high.length }}
          </li>
          <li>
            <strong>Medium Priority:</strong>
            {{ groupTasksByPriority(empReport.tasks).medium.length }}
          </li>
          <li>
            <strong>Low Priority:</strong>
            {{ groupTasksByPriority(empReport.tasks).low.length }}
          </li>
        </ul>
      </div>

      <!-- PRIORITY SECTIONS -->
      <div
        v-for="(tasks, label) in groupTasksByPriority(empReport.tasks)"
        :key="label"
        class="task-section"
      >
        <div class="section-header"
             :class="{
               'report-high-priority-header': label === 'high',
               'report-medium-priority-header': label === 'medium',
               'report-low-priority-header': label === 'low'
             }">
          <span>{{ label.charAt(0).toUpperCase() + label.slice(1) }} Priority</span>
          <span class="task-count">{{ tasks.length }}</span>
        </div>

        <div class="task-details">
          <div v-if="tasks.length" class="priority-section">
            <Card
              v-for="task in tasks"
              :key="task.id"
              class="task-card horizontal-task"
              :class="{ 'task-overdue': isOverdue(task) }"
              @click="openDetails(task)"
            >
              <template #title>
                <p v-if="isOverdue(task)" class="report-overdue-label">‚ö†Ô∏è Overdue</p>
                <div class="task-title-row">
                  <span>{{ task.name }}</span>
                </div>
                <p class="desc" style="font-weight: normal;">{{ task.description }}</p>
              </template>

              <template #content>
                <div class="task-body horizontal-layout">
                  <div class="task-info">
                    <div class="info-item">
                      <i class="pi pi-calendar-plus"></i>
                      <strong>Start:</strong> {{ formatDate(task.created_at) }}
                    </div>

                    <div class="info-item">
                      <i class="pi pi-calendar-times"></i>
                      <strong>Due:</strong> {{ formatDate(task.due_date) }}
                      <span class="relative-time">
                        ({{ formatDateRelative(task.due_date) }})
                      </span>
                    </div>

                    <div class="info-item">
                      <i class="pi pi-bolt"></i>
                      <strong>Priority Score:</strong>
                      {{ task.priority || 'N/A' }}
                    </div>

                    <div class="info-item">
                      <i class="pi pi-check-circle"></i>
                      <strong>Status:</strong>
                      <span
                        class="status-pill"
                        :class="getStatusClass(task.status)"
                      >
                        {{ task.status }}
                      </span>
                    </div>

                    <div class="info-item">
                      <i class="pi pi-user"></i>
                      <strong>Owner:</strong>
                      {{ getOwnerName(task.owner) || empReport.employee.employee_name }}
                    </div>

                    <div class="info-item">
                      <i class="pi pi-users"></i>
                      <strong>Collaborators:</strong>
                      {{ getCollaboratorNames(task.collaborators) || 'None' }}
                    </div>
                  </div>
                </div>
              </template>
            </Card>
          </div>
          <p v-else class="no-tasks-message">No {{ label }} priority tasks</p>
        </div>
      </div>
      <hr class="employee-divider" />
    </div>
  </template>

  <!-- === CASE 2: DEFAULT DEPARTMENT REPORT === -->
  <template v-else>
    <h2 class="report-title">üè¢ Department Report</h2>

    <div class="report-summary">
      <h3>Summary ({{ formattedDeptDateRange }})</h3>
      <ul>
        <li><strong>Department:</strong> {{ dept_overallProgress }}</li>
        <li><strong>Total Tasks:</strong> {{ dept_displayTasks.length }}</li>
        <li><strong>Overdue Tasks:</strong> {{ dept_overdueTasks.length }}</li>
        <li><strong>High Priority:</strong> {{ dept_tasksByPriority.high.length }}</li>
        <li><strong>Medium Priority:</strong> {{ dept_tasksByPriority.medium.length }}</li>
        <li><strong>Low Priority:</strong> {{ dept_tasksByPriority.low.length }}</li>
      </ul>
    </div>

    <!-- Same task sections as before -->
    <div
      v-for="(tasks, label) in dept_tasksByPriority"
      :key="label"
      class="task-section"
    >
      <div class="section-header"
           :class="{
             'report-high-priority-header': label === 'high',
             'report-medium-priority-header': label === 'medium',
             'report-low-priority-header': label === 'low'
           }">
        <span>{{ label.charAt(0).toUpperCase() + label.slice(1) }} Priority</span>
        <span class="task-count">{{ tasks.length }}</span>
      </div>

      <div class="task-details">
        <div v-if="tasks.length" class="priority-section">
          <Card
            v-for="task in tasks"
            :key="task.id"
            class="task-card horizontal-task"
            :class="{ 'task-overdue': isOverdue(task) }"
            @click="openDetails(task)"
          >
            <template #title>
              <p v-if="isOverdue(task)" class="report-overdue-label">‚ö†Ô∏è Overdue</p>
              <div class="task-title-row">
                <span>{{ task.name }}</span>
              </div>
              <p class="desc" style="font-weight: normal;">{{ task.description }}</p>
            </template>

            <template #content>
              <div class="task-body horizontal-layout">
                <div class="task-info">
                  <div class="info-item">
                    <i class="pi pi-calendar-plus"></i>
                    <strong>Start:</strong> {{ formatDate(task.created_at) }}
                  </div>

                  <div class="info-item">
                    <i class="pi pi-calendar-times"></i>
                    <strong>Due:</strong> {{ formatDate(task.due_date) }}
                    <span class="relative-time">
                      ({{ formatDateRelative(task.due_date) }})
                    </span>
                  </div>

                  <div class="info-item">
                    <i class="pi pi-bolt"></i>
                    <strong>Priority Score:</strong>
                    {{ task.priority || 'N/A' }}
                  </div>

                  <div class="info-item">
                    <i class="pi pi-check-circle"></i>
                    <strong>Status:</strong>
                    <span class="status-pill" :class="getStatusClass(task.status)">
                      {{ task.status }}
                    </span>
                  </div>

                  <div class="info-item">
                    <i class="pi pi-user"></i>
                    <strong>Owner:</strong> {{ getOwnerName(task.owner) }}
                  </div>

                  <div class="info-item">
                    <i class="pi pi-users"></i>
                    <strong>Collaborators:</strong> {{ getCollaboratorNames(task.collaborators) || 'None' }}
                  </div>
                </div>
              </div>
            </template>
          </Card>
        </div>
        <p v-else class="no-tasks-message">No {{ label }} priority tasks</p>
      </div>
    </div>
  </template>
</div>

</div>









</div>